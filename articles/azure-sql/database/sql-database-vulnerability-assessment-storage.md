---
title: Almacenamiento de los resultados del examen de evaluación de vulnerabilidad en una cuenta de almacenamiento accesible detrás de firewalls y redes virtuales
description: Se proporcionan instrucciones sobre cómo almacenar exámenes de evaluación de vulnerabilidad (VA) en una cuenta de almacenamiento a la que se puede tener acceso a través de un firewall o una red virtual.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 12/01/2020
ms.openlocfilehash: 07d9d46d9ef234070a213fff25f883b29ebf604b
ms.sourcegitcommit: 100390fefd8f1c48173c51b71650c8ca1b26f711
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 01/27/2021
ms.locfileid: "98894650"
---
# <a name="store-vulnerability-assessment-scan-results-in-a-storage-account-accessible-behind-firewalls-and-vnets"></a>Almacenamiento de los resultados del examen de evaluación de vulnerabilidad en una cuenta de almacenamiento accesible detrás de firewalls y redes virtuales
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

Si está limitando el acceso a su cuenta de almacenamiento en Azure para determinados servicios o redes virtuales, deberá habilitar la configuración adecuada para que los exámenes de evaluación de vulnerabilidad (VA) para SQL Database o instancias administradas tengan acceso a dicha cuenta de almacenamiento.

## <a name="enable-azure-sql-database-va-scanning-access-to-the-storage-account"></a>Habilitación del acceso de los exámenes de VA de Azure SQL Database a la cuenta de almacenamiento

Si ha configurado la cuenta de almacenamiento de VA para que solo sea accesible mediante determinados servicios o redes, deberá asegurarse de que los exámenes de VA para Azure SQL Database puedan almacenar los exámenes en la cuenta de almacenamiento. Puede usar la cuenta de almacenamiento existente o crear una nueva para almacenar los resultados del examen de VA de todas las bases de datos en su [servidor SQL lógico](logical-servers.md).

> [!NOTE]
> El servicio de evaluación de vulnerabilidades no puede acceder a las cuentas de almacenamiento protegidas con firewalls o redes virtuales si necesitan claves de acceso de almacenamiento.

Vaya al **grupo de recursos** que contenga la cuenta de almacenamiento y obtenga acceso al panel **Cuenta de almacenamiento**. En **Configuración**, seleccione **Firewall y redes virtuales**.

Asegúrese de que la opción **Permitir que los servicios de Microsoft de confianza accedan a esta cuenta de almacenamiento** está habilitada.

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-allow-microsoft-services.png" alt-text="Captura de pantalla que muestra el cuadro de diálogo Firewall y redes virtuales, con la opción Permitir que los servicios de Microsoft de confianza accedan a esta cuenta de almacenamiento seleccionada.":::

Para saber qué cuenta de almacenamiento se usa, vaya al panel de **SQL Server** en [Azure Portal](https://portal.azure.com) y, en **Seguridad**, seleccione **Security Center**.

:::image type="content" source="../database/media/azure-defender-for-sql/va-storage.png" alt-text="Configuración de la evaluación de vulnerabilidades":::

## <a name="store-va-scan-results-for-azure-sql-managed-instance-in-a-storage-account-that-can-be-accessed-behind-a-firewall-or-vnet"></a>Almacenamiento de los resultados del examen de VA para Instancia administrada de Azure SQL en una cuenta de almacenamiento a la que se puede tener acceso detrás de un firewall o una red virtual

Dado que Instancia administrada no es un servicio de Microsoft de confianza y que tiene una red virtual diferente a la cuenta de almacenamiento, la ejecución del examen de VA producirá un error.

Para admitir los exámenes de VA en Instancias administradas, siga estos pasos:

1. En el panel **Instancia administrada de SQL**, en el título **Información general**, haga clic en el vínculo **Red virtual o subred**. De esta forma, se le dirige al panel **Red virtual**.

   :::image type="content" source="../managed-instance/media/public-endpoint-configure/mi-overview.png" alt-text="mi-overview2":::

1. En **Configuración**, seleccione **Subredes**. En el panel nuevo, haga clic en **Subred** para agregar una subred y deléguela a *Microsoft.Sql\managedInstance*. Para obtener más información, consulte [Administración de subredes](../../virtual-network/virtual-network-manage-subnet.md).

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-subnets.png" alt-text="Captura de pantalla que muestra una subred en la que se ha delegado Microsoft.sql\managedInstance.":::

1. En el panel **Red virtual**, en **Configuración**, seleccione **Puntos de conexión de servicio**. En el panel nuevo, haga clic en **Agregar** y agregue el servicio *Microsoft.Storage* como nuevo punto de conexión de servicio. Asegúrese de que se ha seleccionado la subred *ManagedInstance*. Haga clic en **Agregar**.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-service-endpoint.png" alt-text="Captura de pantalla que muestra Agregar puntos de conexión de servicio, donde se agrega el servicio Microsoft.Storage como punto de conexión.":::

1. Vaya a la **cuenta de almacenamiento** que ha seleccionado para almacenar los exámenes de VA. En **Configuración**, seleccione **Firewall y redes virtuales**. Haga clic en **Agregar red virtual existente**. Seleccione la red virtual y la subred de la instancia administrada y haga clic en **Agregar**.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-firewall.png" alt-text="Captura de pantalla que muestra el panel Firewall y redes virtuales, que contiene el vínculo Agregar red virtual existente.":::

Ahora debería poder almacenar los exámenes de VA para Instancias administradas en la cuenta de almacenamiento.

## <a name="next-steps"></a>Pasos siguientes

- [Evaluación de vulnerabilidad](sql-vulnerability-assessment.md)
- [Creación de una cuenta de Azure Storage](../../storage/common/storage-account-create.md)
- [Azure Defender for SQL](azure-defender-for-sql.md)
